<html>
  <head>
    <script
      type="text/javascript"
      src="https://cdn.rawgit.com/ricmoo/aes-js/e27b99df/index.js"
    ></script>
    <script>
      function encrypt(text, mk) {
        // CBC Mode
      // An example 128-bit key
      var key = [mk.charCodeAt(0), 
      mk.charCodeAt(1), 
      mk.charCodeAt(2), 
      mk.charCodeAt(3),
      mk.charCodeAt(4), 
      mk.charCodeAt(5), 
      mk.charCodeAt(6), 
      mk.charCodeAt(7), 
      mk.charCodeAt(8), 
      mk.charCodeAt(9), 
      mk.charCodeAt(10), 
      mk.charCodeAt(11), 
      mk.charCodeAt(12),
      mk.charCodeAt(13),
      mk.charCodeAt(14), 
      mk.charCodeAt(15)];
      console.log(key);
      // The initialization vector (must be 16 bytes)
      var iv = [66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66];
      // Convert text to bytes (text must be a multiple of 16 bytes)
      //var text = "TextMustBe16Byte";
      //var text=document.getElementById("server_ip").value;
      text=text.padStart(16,"A");
      console.log(text);
      var textBytes = aesjs.utils.utf8.toBytes(text);
      var aesCbc = new aesjs.ModeOfOperation.cbc(key, iv);
      var encryptedBytes = aesCbc.encrypt(textBytes);
      // To print or store the binary data, you may convert it to hex
      var encryptedHex = aesjs.utils.hex.fromBytes(encryptedBytes);
      console.log(encryptedHex);
      return encryptedHex;
      // "104fb073f9a131f2cab49184bb864ca2"

      //------Decryption------------:
      // When ready to decrypt the hex string, convert it back to bytes
      //var encryptedBytes = aesjs.utils.hex.toBytes(encryptedHex);
      // The cipher-block chaining mode of operation maintains internal
      // state, so to decrypt a new instance must be instantiated.
      //var aesCbc = new aesjs.ModeOfOperation.cbc(key, iv);
      //var decryptedBytes = aesCbc.decrypt(encryptedBytes);

      // Convert our bytes back into text
      //var decryptedText = aesjs.utils.utf8.fromBytes(decryptedBytes);
      //console.log(decryptedText);
      // "TextMustBe16Byte"
      }

      function myFunction() {
        var server_ip = document.getElementById("server_ip").value;
        var server_port = document.getElementById("server_port").value;
        var wifi_name = document.getElementById("wifi_name").value;
        var wifi_pass = document.getElementById("wifi_pass").value;

        var key = document.getElementById("key").value;

        console.log(server_ip);
        console.log(key);
        console.log(encrypt(server_ip, key));
        console.log(encrypt(server_port, key));
        console.log(encrypt(wifi_name, key));
        console.log(encrypt(wifi_pass, key));
      }
    </script>
  </head>
  <body style="margin: auto; width: 50%; background-color: rgb(103, 169, 217)">
    <h1><br /></h1>
    <h2
      style="
        background-color: rgb(162, 213, 240);
        text-align: center;
        border-radius: 20px;
      "
    >
      IoT Medical Device Configuration
    </h2>
    <form action="/action_page.php">
      <label for="server_ip">Server Ip Address:</label>
      <input
        type="text"
        id="server_ip"
        name="server_ip"
        value="192.168.x.x"
      /><br /><br />
      <label for="server_port">Server Port:</label>
      <input
        type="text"
        id="server_port"
        name="server_port"
        value="9999"
      /><br /><br />
      <label for="wifi_name">Wi-Fi Network:</label>
      <input
        type="text"
        id="wifi_name"
        name="wifi_name"
        value="iot4"
      /><br /><br />
      <label for="wifi_name">Wi-Fi Password:</label>
      <input
        type="text"
        id="wifi_pass"
        name="wifi_pass"
        value="1234"
      /><br /><br />
      <label for="key">Key: </label>
      <input type="text" id="key" name="key" value="AAAAAAAAAAAAAAAA" /><br /><br />
      <input type="submit" value="php" />
    </form>

    <button type="button" onclick="myFunction()">Save</button>
    <p id="cipher_text">hola</p>
    <p>
      If you click the "Save" button, the information will be saved in the
      device.
    </p>
  </body>
</html>
